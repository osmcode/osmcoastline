
OSMCoastline
============

OSMCoastline extracts the coastline from an OSM planet file and assembles all
the pieces into polygons for use in map renderers etc.

PREREQUISITES
-------------

Osmium
    http://github.com/joto/osmium
    http://wiki.openstreetmap.org/wiki/Osmium
    (Do not use the Osmium coming with Ubuntu 12.04, it is too old.)

boost (several libraries)
    http://www.boost.org/
    Debian/Ubuntu: libboost-dev

zlib (for PBF support)
    http://www.zlib.net/
    Debian/Ubuntu: zlib1g-dev

GDAL (for OGR support)
    http://gdal.org/
    Debian/Ubuntu: libgdal1-dev
    (Must be built with GEOS support which is the true for Debian/Ubuntu
    packages. You need GDAL 1.7.0 or greater, consider using
    https://wiki.ubuntu.com/UbuntuGIS when using Ubuntu to get newer
    versions of GIS libraries.)

GEOS (for assembling multipolygons etc.)
    http://trac.osgeo.org/geos/
    Debian/Ubuntu: libgeos-dev


BUILDING
--------

You'll need all the prerequisites including Osmium installed.

Run "make" to build the "osmcoastline" and "osmcoastline_filter" programs.

Run "make clean" to clean up.


TESTING
-------

Run the script "runtest.sh". It will read the supplied "testdata.osm" and
create output in the testdata.db spatialite database.

You can use the supplied "coastline_sqlite.qgs" QGIS project file to open the
output with QGIS.


RUNNING
-------

Run:
  osmcoastline -o DBFILE PLANET-FILE

For example:
  osmcoastline -o coastline.db planet.osm.pbf

This will create DBFILE spatialite database and write several tables with the
output into it.


OUTPUT
------

The output is a spatialite database with the following tables:

* error_lines
  Lines that have errors (for instance not closed rings or self-intersections).

* error_points
  Problematic points such as intersections.

* land_polygons
  Finished assembled land polygons.

* water_polygons
  Finished assembled water polygons.

* rings
  Coastline rings as linestrings.

Depending on the command line options some or all of these tables might be
filled with data.

By default all output is in WGS84. You can use the option -s/--srs=3857 to
create output in "Google mercator". (Other projections are curently not
supported.)


STEPS
-----

OSMCoastline runs in several steps, each can optionally create some output.
In most cases you will only be interested in the end result but preliminary
results are supplied for debugging or other special uses.

Step 1: Filter out all nodes and ways tagged natural=coastline and all nodes
        needed by those ways.

Step 2: Assemble all coastline ways into rings.

Step 3: Assemble polygons from the rings, possibly including holes for
        water areas.

Step 4: Split up large polygons into smaller ones.

Step 5: Create water polygons as the "inverse" of the land polygons.

The errors encountered in each step are written to the error_points and
error_lines tables.


RETURN CODES
------------

0 - OK
1 - Warning (some geometries with errors were detected and probably fixed)
2 - Error (some geometry errors were detected that could not be fixed)
3 - Fatal error (output file could not be opened etc.)
4 - Error parsing command line arguments


OSMCOASTLINE_FILTER
-------------------

The program "osmcoastline_filter" can be used to filter from an OSM planet
file all nodes and ways needed for building the coastlines and writing them out
in OSM format. This file will be a lot smaller (less than 1%) than the original
planet file, but it contains everything needed to assemble the coastline polygons.

If you are playing around or want to run "osmcoastline" several times with
different parameters, run "osmcoastline_filter" once first and use its output
as the input for "osmcoastline".

Run it as follows:
  osmcoastline_filter -o OUTFILE INFILE


LICENSE
-------

OSMCoastline is available under the GNU GPL version 3 or later.


AUTHORS
-------

Jochen Topf <jochen@topf.org>

