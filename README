
OSMCoastline
============

OSMCoastline extracts the coastline from an OSM planet file and assembles all
the pieces into polygons for use in map renderers etc.

This is a preliminary version that needs more work.


PREREQUISITES
-------------

Osmium
    http://github.com/joto/osmium
    http://wiki.openstreetmap.org/wiki/Osmium

boost (several libraries)
    http://www.boost.org/
    Debian/Ubuntu: libboost-dev

zlib (for PBF support)
    http://www.zlib.net/
    Debian/Ubuntu: zlib1g-dev

GDAL (for OGR support)
    http://gdal.org/
    Debian/Ubuntu: libgdal1-dev
    (must be built with GEOS support which is the true for Debian/Ubuntu
    packages)

GEOS (for assembling multipolygons etc.)
    http://trac.osgeo.org/geos/
    Debian/Ubuntu: libgeos-dev


BUILDING
--------

You'll need all the prerequisites including Osmium installed.

Run "make" to build the "osmcoastline" program.

Run "make clean" to clean up.


TESTING
-------

Run the script "runtest.sh". It will read the supplied "testdata.osm" and
create output in the testdata.db spatialite database.

You can use the supplied "coastline_sqlite.qgs" QGIS project file to open the
output with QGIS.


RUNNING
-------

Run:
  osmcoastline -o DBFILE PLANET-FILE

For example:
  osmcoastline -o coastline.db planet.osm.pbf

This will create DBFILE spatialite database and write several tables with the
output into it.


OUTPUT
------

The output is a spatialite database with the following tables:

* error_lines
  Lines that have errors (for instance not closed rings or self-intersections).

* error_points
  Problematic points such as intersections.

* polygons
  Finished assembled land polygons.

* rings
  Coastline rings as linestrings.

By default all output is in WGS84. You can use the option -s/--srs=3857 to
create output in "Google mercator". (Other projections are curently not
supported.)


STEPS
-----

OSMCoastline runs in several steps, each can optionally create some output.
In most cases you will only be interested in the end result but preliminary
results are supplied for debugging or other special uses.

Step 1: Filter out all nodes and ways tagged natural=coastline and all nodes
        needed by those ways. The result of this step can be written out as
        an OSM file with the -r/--raw-output option.

Step 2: Assemble all coastline ways into rings.

Step 3: Assemble polygons from the rings, possibly including holes for
        water areas.

Step 4: Split up large polygons into smaller ones.

The errors encountered in each step are written to the error_points and
error_lines tables.


RETURN CODES
------------

0 - OK
1 - Warning (some geometries with errors were detected and probably fixed)
2 - Error (some geometry errors were detected that could not be fixed)
3 - Fatal error (output file could not be opened etc.)
4 - Error parsing command line arguments


LICENSE
-------

Osmium is available under the GNU GPL version 3 or later.


AUTHORS
-------

Jochen Topf <jochen@topf.org>

